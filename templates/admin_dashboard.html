{% extends "base.html" %}
{% block content %}

<div class="container my-5 py-5">
  <div class="mx-auto bg-white p-5 rounded shadow-sm" style="max-width: 1100px;">
    <h1 class="fw-bold text-primary mb-4">Dashboard Amministratore</h1>

    <!-- Filtri -->
    <form method="GET" class="row g-3 align-items-end mb-5">
      <div class="col-12 col-md-3">
        <label for="from" class="form-label">Da:</label>
        <input type="date" id="from" name="from" value="{{ request.args.get('from', '') }}" class="form-control">
      </div>
      <div class="col-12 col-md-3">
        <label for="to" class="form-label">A:</label>
        <input type="date" id="to" name="to" value="{{ request.args.get('to', '') }}" class="form-control">
      </div>
      <div class="col-12 col-md-4">
        <label for="email" class="form-label">Email utente:</label>
        <input type="text" id="email" name="email" placeholder="Email utente"
               value="{{ request.args.get('email', '') }}" class="form-control">
      </div>
      <div class="col-12 col-md-2">
        <button type="submit" class="btn btn-primary w-100">Filtra</button>
      </div>
    </form>

    <!-- Statistiche -->
    <div class="row g-5 mb-5">
    <div class="col-12 col-md-6 text-center text-md-start stats-box">
        <h2 class="h5 fw-semibold mb-2">Utenti Registrati</h2>
        <p class="display-5 text-primary fw-bold">{{ stats['user_count'] }}</p>
    </div>
    <div class="col-12 col-md-6 text-center text-md-start stats-box">
        <h2 class="h5 fw-semibold mb-2">Documenti Totali</h2>
        <p class="display-5 text-success fw-bold">{{ stats['document_count'] }}</p>
    </div>
    </div>


    <!-- Chart -->
    <div>
      <h2 class="h5 fw-semibold mb-3">Documenti per Mese</h2>
      <canvas id="docsChart" height="100"></canvas>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('docsChart').getContext('2d');
  const chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: {{ months | safe }},
      datasets: [{
        label: 'Documenti caricati',
        data: {{ counts | safe }},
        backgroundColor: 'rgba(13, 110, 253, 0.7)', /* Bootstrap primary color */
        borderRadius: 4
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
</script>

{% endblock %}
